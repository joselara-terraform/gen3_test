[agent]
  interval = "5s"
  round_interval = true
  metric_batch_size = 1000
  metric_buffer_limit = 10000
  collection_jitter = "0s"
  flush_interval = "1s"
  flush_jitter = "0s"
  precision = ""
  hostname = "MK1_AWE"
  omit_hostname = false

# Output to InfluxDB
[[outputs.influxdb_v2]]
  urls = ["http://localhost:8086"]
  token = "$INFLUX_TOKEN"
  organization = "electrolyzer"
  bucket = "electrolyzer_data"
  timeout = "5s"

# Thermocouple Module (TCM)
[[inputs.modbus]]
  name = "temperature_controller"
  slave_id = 1
  timeout = "1s"
  interval = "1s"
  controller = "tcp://192.168.10.13:502"
  
  holding_registers = [
    { name = "TC01", byte_order = "AB", data_type = "UFIXED", scale = 0.1, address = [32]},
    { name = "TC02", byte_order = "AB", data_type = "UFIXED", scale = 0.1, address = [33]},
    { name = "TC03", byte_order = "AB", data_type = "UFIXED", scale = 0.1, address = [34]},
    { name = "TC04", byte_order = "AB", data_type = "UFIXED", scale = 0.1, address = [35]},
    { name = "TC05", byte_order = "AB", data_type = "UFIXED", scale = 0.1, address = [36]},
    { name = "TC06", byte_order = "AB", data_type = "UFIXED", scale = 0.1, address = [37]},
    { name = "TC07", byte_order = "AB", data_type = "UFIXED", scale = 0.1, address = [38]},
    { name = "TC08", byte_order = "AB", data_type = "UFIXED", scale = 0.1, address = [39]},
    { name = "TC09", byte_order = "AB", data_type = "UFIXED", scale = 0.1, address = [40]},
    { name = "TC10", byte_order = "AB", data_type = "UFIXED", scale = 0.1, address = [41]},
    { name = "TC11", byte_order = "AB", data_type = "UFIXED", scale = 0.1, address = [42]},
    { name = "TC12", byte_order = "AB", data_type = "UFIXED", scale = 0.1, address = [43]},
    { name = "TC13", byte_order = "AB", data_type = "UFIXED", scale = 0.1, address = [44]},
    { name = "TC14", byte_order = "AB", data_type = "UFIXED", scale = 0.1, address = [45]},
    { name = "TC15", byte_order = "AB", data_type = "UFIXED", scale = 0.1, address = [46]},
    { name = "TC16", byte_order = "AB", data_type = "UFIXED", scale = 0.1, address = [47]}
  ]

# Analog Inputs (AIM)
[[inputs.modbus]]
  name = "analog_input"
  name_override = "analog_inputs"
  interval = "10ms"
  slave_id = 1
  timeout = "20ms"
  controller = "tcp://192.168.10.14:502"

  input_registers = [
    { name = "AI01", byte_order = "AB", data_type = "UFIXED", scale = 0.001, address = [0]},
    { name = "AI02", byte_order = "AB", data_type = "UFIXED", scale = 0.001, address = [1]},
    { name = "AI03", byte_order = "AB", data_type = "UFIXED", scale = 0.001, address = [2]},
    { name = "AI04", byte_order = "AB", data_type = "UFIXED", scale = 0.001, address = [3]},
    { name = "AI05", byte_order = "AB", data_type = "UFIXED", scale = 0.001, address = [4]},
    { name = "AI06", byte_order = "AB", data_type = "UFIXED", scale = 0.001, address = [5]},
    { name = "AI07", byte_order = "AB", data_type = "UFIXED", scale = 0.001, address = [6]},
    { name = "AI08", byte_order = "AB", data_type = "UFIXED", scale = 0.001, address = [7]}
  ]

# LabJack T7 (Gen2 PSU Control - AIN0 via HTTP bridge)
[[inputs.http]]
  urls = ["http://localhost:8891/metrics"]
  timeout = "1s"
  interval = "100ms"
  data_format = "influx"
  
  [inputs.http.tags]
    location = "electrolyzer_panel"
    sensor_type = "psu_control"

# Relay Module (RLM)
[[inputs.modbus]]
  name = "relay_module"
  slave_id = 1
  timeout = "1s"
  interval = "1s"
  controller = "tcp://192.168.10.2:502"
  
  coils = [
    { name = "RL01", address = [0]},
    { name = "RL02", address = [1]},
    { name = "RL03", address = [2]},
    { name = "RL04", address = [3]},
    { name = "RL05", address = [4]},
    { name = "RL06", address = [5]},
    { name = "RL07", address = [6]},
    { name = "RL08", address = [7]},
    { name = "RL09", address = [8]},
    { name = "RL10", address = [9]},
    { name = "RL11", address = [10]},
    { name = "RL12", address = [11]},
    { name = "RL13", address = [12]},
    { name = "RL14", address = [13]},
    { name = "RL15", address = [14]},
    { name = "RL16", address = [15]},
    { name = "RL17", address = [16]},
    { name = "RL18", address = [17]},
    { name = "RL19", address = [18]},
    { name = "RL20", address = [19]},
    { name = "RL21", address = [20]},
    { name = "RL22", address = [21]},
    { name = "RL23", address = [22]},
    { name = "RL24", address = [23]},
    { name = "RL25", address = [24]},
    { name = "RL26", address = [25]},
    { name = "RL27", address = [26]},
    { name = "RL28", address = [27]},
    { name = "RL29", address = [28]},
    { name = "RL30", address = [29]}
  ]

# Binary Gas Analyzer 1
[[inputs.http]]
  urls = ["http://localhost:8888/metrics"]
  timeout = "80ms"
  interval = "100ms"
  data_format = "influx"
  name_override = "bga_metrics"
  
  [inputs.http.tags]
    location = "electrolyzer_panel"
    sensor_type = "gas_analyzer"
    bga_id = "BGA01"

# Binary Gas Analyzer 2
[[inputs.http]]
  urls = ["http://localhost:8889/metrics"]
  timeout = "80ms"
  interval = "100ms"
  data_format = "influx"
  name_override = "bga_metrics"
  
  [inputs.http.tags]
    location = "electrolyzer_panel"
    sensor_type = "gas_analyzer"
    bga_id = "BGA02"

# Cell Voltage Monitor (CVM24P)
[[inputs.http]]
  urls = ["http://localhost:8890/metrics"]
  timeout = "200ms"
  interval = "100ms"
  data_format = "influx"
  
  [inputs.http.tags]
    location = "electrolyzer_panel"
    sensor_type = "cell_voltage_monitor"

# PSU Monitoring (PSU01-PSU10 via MM01/MM02)
[[inputs.modbus]]
  name = "psu01"
  slave_id = 1
  timeout = "200ms"
  interval = "100ms"
  controller = "tcp://192.168.10.3:502"
  
  holding_registers = [
    { name = "voltage", byte_order = "AB", data_type = "UFIXED", scale = 0.1, address = [1]},
    { name = "current", byte_order = "AB", data_type = "UFIXED", scale = 0.1, address = [2]},
    { name = "power", byte_order = "AB", data_type = "UFIXED", scale = 0.1, address = [3]},
    { name = "capacity", byte_order = "AB", data_type = "UFIXED", scale = 0.1, address = [4]},
    { name = "runtime", byte_order = "AB", data_type = "UINT16", scale = 1.0, address = [5]},
    { name = "battery_v", byte_order = "AB", data_type = "UFIXED", scale = 0.1, address = [6]},
    { name = "sys_fault", byte_order = "AB", data_type = "UINT16", scale = 1.0, address = [7]},
    { name = "mod_fault", byte_order = "AB", data_type = "UINT16", scale = 1.0, address = [8]},
    { name = "temperature", byte_order = "AB", data_type = "UINT16", scale = 1.0, address = [9]},
    { name = "status", byte_order = "AB", data_type = "UINT16", scale = 1.0, address = [10]},
    { name = "set_voltage_rb", byte_order = "AB", data_type = "UFIXED", scale = 0.1, address = [11]},
    { name = "set_current_rb", byte_order = "AB", data_type = "UFIXED", scale = 0.1, address = [12]},
    { name = "output_enable", byte_order = "AB", data_type = "UINT16", scale = 1.0, address = [13]}
  ]

[[inputs.modbus]]
  name = "psu02"
  slave_id = 1
  timeout = "200ms"
  interval = "100ms"
  controller = "tcp://192.168.10.4:502"
  
  holding_registers = [
    { name = "voltage", byte_order = "AB", data_type = "UFIXED", scale = 0.1, address = [1]},
    { name = "current", byte_order = "AB", data_type = "UFIXED", scale = 0.1, address = [2]},
    { name = "power", byte_order = "AB", data_type = "UFIXED", scale = 0.1, address = [3]},
    { name = "capacity", byte_order = "AB", data_type = "UFIXED", scale = 0.1, address = [4]},
    { name = "runtime", byte_order = "AB", data_type = "UINT16", scale = 1.0, address = [5]},
    { name = "battery_v", byte_order = "AB", data_type = "UFIXED", scale = 0.1, address = [6]},
    { name = "sys_fault", byte_order = "AB", data_type = "UINT16", scale = 1.0, address = [7]},
    { name = "mod_fault", byte_order = "AB", data_type = "UINT16", scale = 1.0, address = [8]},
    { name = "temperature", byte_order = "AB", data_type = "UINT16", scale = 1.0, address = [9]},
    { name = "status", byte_order = "AB", data_type = "UINT16", scale = 1.0, address = [10]},
    { name = "set_voltage_rb", byte_order = "AB", data_type = "UFIXED", scale = 0.1, address = [11]},
    { name = "set_current_rb", byte_order = "AB", data_type = "UFIXED", scale = 0.1, address = [12]},
    { name = "output_enable", byte_order = "AB", data_type = "UINT16", scale = 1.0, address = [13]}
  ]

[[inputs.modbus]]
  name = "psu03"
  slave_id = 1
  timeout = "200ms"
  interval = "100ms"
  controller = "tcp://192.168.10.5:502"
  
  holding_registers = [
    { name = "voltage", byte_order = "AB", data_type = "UFIXED", scale = 0.1, address = [1]},
    { name = "current", byte_order = "AB", data_type = "UFIXED", scale = 0.1, address = [2]},
    { name = "power", byte_order = "AB", data_type = "UFIXED", scale = 0.1, address = [3]},
    { name = "capacity", byte_order = "AB", data_type = "UFIXED", scale = 0.1, address = [4]},
    { name = "runtime", byte_order = "AB", data_type = "UINT16", scale = 1.0, address = [5]},
    { name = "battery_v", byte_order = "AB", data_type = "UFIXED", scale = 0.1, address = [6]},
    { name = "sys_fault", byte_order = "AB", data_type = "UINT16", scale = 1.0, address = [7]},
    { name = "mod_fault", byte_order = "AB", data_type = "UINT16", scale = 1.0, address = [8]},
    { name = "temperature", byte_order = "AB", data_type = "UINT16", scale = 1.0, address = [9]},
    { name = "status", byte_order = "AB", data_type = "UINT16", scale = 1.0, address = [10]},
    { name = "set_voltage_rb", byte_order = "AB", data_type = "UFIXED", scale = 0.1, address = [11]},
    { name = "set_current_rb", byte_order = "AB", data_type = "UFIXED", scale = 0.1, address = [12]},
    { name = "output_enable", byte_order = "AB", data_type = "UINT16", scale = 1.0, address = [13]}
  ]

[[inputs.modbus]]
  name = "psu04"
  slave_id = 1
  timeout = "200ms"
  interval = "100ms"
  controller = "tcp://192.168.10.6:502"
  
  holding_registers = [
    { name = "voltage", byte_order = "AB", data_type = "UFIXED", scale = 0.1, address = [1]},
    { name = "current", byte_order = "AB", data_type = "UFIXED", scale = 0.1, address = [2]},
    { name = "power", byte_order = "AB", data_type = "UFIXED", scale = 0.1, address = [3]},
    { name = "capacity", byte_order = "AB", data_type = "UFIXED", scale = 0.1, address = [4]},
    { name = "runtime", byte_order = "AB", data_type = "UINT16", scale = 1.0, address = [5]},
    { name = "battery_v", byte_order = "AB", data_type = "UFIXED", scale = 0.1, address = [6]},
    { name = "sys_fault", byte_order = "AB", data_type = "UINT16", scale = 1.0, address = [7]},
    { name = "mod_fault", byte_order = "AB", data_type = "UINT16", scale = 1.0, address = [8]},
    { name = "temperature", byte_order = "AB", data_type = "UINT16", scale = 1.0, address = [9]},
    { name = "status", byte_order = "AB", data_type = "UINT16", scale = 1.0, address = [10]},
    { name = "set_voltage_rb", byte_order = "AB", data_type = "UFIXED", scale = 0.1, address = [11]},
    { name = "set_current_rb", byte_order = "AB", data_type = "UFIXED", scale = 0.1, address = [12]},
    { name = "output_enable", byte_order = "AB", data_type = "UINT16", scale = 1.0, address = [13]}
  ]

[[inputs.modbus]]
  name = "psu05"
  slave_id = 1
  timeout = "200ms"
  interval = "100ms"
  controller = "tcp://192.168.10.7:502"
  
  holding_registers = [
    { name = "voltage", byte_order = "AB", data_type = "UFIXED", scale = 0.1, address = [1]},
    { name = "current", byte_order = "AB", data_type = "UFIXED", scale = 0.1, address = [2]},
    { name = "power", byte_order = "AB", data_type = "UFIXED", scale = 0.1, address = [3]},
    { name = "capacity", byte_order = "AB", data_type = "UFIXED", scale = 0.1, address = [4]},
    { name = "runtime", byte_order = "AB", data_type = "UINT16", scale = 1.0, address = [5]},
    { name = "battery_v", byte_order = "AB", data_type = "UFIXED", scale = 0.1, address = [6]},
    { name = "sys_fault", byte_order = "AB", data_type = "UINT16", scale = 1.0, address = [7]},
    { name = "mod_fault", byte_order = "AB", data_type = "UINT16", scale = 1.0, address = [8]},
    { name = "temperature", byte_order = "AB", data_type = "UINT16", scale = 1.0, address = [9]},
    { name = "status", byte_order = "AB", data_type = "UINT16", scale = 1.0, address = [10]},
    { name = "set_voltage_rb", byte_order = "AB", data_type = "UFIXED", scale = 0.1, address = [11]},
    { name = "set_current_rb", byte_order = "AB", data_type = "UFIXED", scale = 0.1, address = [12]},
    { name = "output_enable", byte_order = "AB", data_type = "UINT16", scale = 1.0, address = [13]}
  ]

[[inputs.modbus]]
  name = "psu06"
  slave_id = 1
  timeout = "200ms"
  interval = "100ms"
  controller = "tcp://192.168.10.8:502"
  
  holding_registers = [
    { name = "voltage", byte_order = "AB", data_type = "UFIXED", scale = 0.1, address = [1]},
    { name = "current", byte_order = "AB", data_type = "UFIXED", scale = 0.1, address = [2]},
    { name = "power", byte_order = "AB", data_type = "UFIXED", scale = 0.1, address = [3]},
    { name = "capacity", byte_order = "AB", data_type = "UFIXED", scale = 0.1, address = [4]},
    { name = "runtime", byte_order = "AB", data_type = "UINT16", scale = 1.0, address = [5]},
    { name = "battery_v", byte_order = "AB", data_type = "UFIXED", scale = 0.1, address = [6]},
    { name = "sys_fault", byte_order = "AB", data_type = "UINT16", scale = 1.0, address = [7]},
    { name = "mod_fault", byte_order = "AB", data_type = "UINT16", scale = 1.0, address = [8]},
    { name = "temperature", byte_order = "AB", data_type = "UINT16", scale = 1.0, address = [9]},
    { name = "status", byte_order = "AB", data_type = "UINT16", scale = 1.0, address = [10]},
    { name = "set_voltage_rb", byte_order = "AB", data_type = "UFIXED", scale = 0.1, address = [11]},
    { name = "set_current_rb", byte_order = "AB", data_type = "UFIXED", scale = 0.1, address = [12]},
    { name = "output_enable", byte_order = "AB", data_type = "UINT16", scale = 1.0, address = [13]}
  ]

[[inputs.modbus]]
  name = "psu07"
  slave_id = 1
  timeout = "200ms"
  interval = "100ms"
  controller = "tcp://192.168.10.9:502"
  
  holding_registers = [
    { name = "voltage", byte_order = "AB", data_type = "UFIXED", scale = 0.1, address = [1]},
    { name = "current", byte_order = "AB", data_type = "UFIXED", scale = 0.1, address = [2]},
    { name = "power", byte_order = "AB", data_type = "UFIXED", scale = 0.1, address = [3]},
    { name = "capacity", byte_order = "AB", data_type = "UFIXED", scale = 0.1, address = [4]},
    { name = "runtime", byte_order = "AB", data_type = "UINT16", scale = 1.0, address = [5]},
    { name = "battery_v", byte_order = "AB", data_type = "UFIXED", scale = 0.1, address = [6]},
    { name = "sys_fault", byte_order = "AB", data_type = "UINT16", scale = 1.0, address = [7]},
    { name = "mod_fault", byte_order = "AB", data_type = "UINT16", scale = 1.0, address = [8]},
    { name = "temperature", byte_order = "AB", data_type = "UINT16", scale = 1.0, address = [9]},
    { name = "status", byte_order = "AB", data_type = "UINT16", scale = 1.0, address = [10]},
    { name = "set_voltage_rb", byte_order = "AB", data_type = "UFIXED", scale = 0.1, address = [11]},
    { name = "set_current_rb", byte_order = "AB", data_type = "UFIXED", scale = 0.1, address = [12]},
    { name = "output_enable", byte_order = "AB", data_type = "UINT16", scale = 1.0, address = [13]}
  ]

[[inputs.modbus]]
  name = "psu08"
  slave_id = 1
  timeout = "200ms"
  interval = "100ms"
  controller = "tcp://192.168.10.10:502"
  
  holding_registers = [
    { name = "voltage", byte_order = "AB", data_type = "UFIXED", scale = 0.1, address = [1]},
    { name = "current", byte_order = "AB", data_type = "UFIXED", scale = 0.1, address = [2]},
    { name = "power", byte_order = "AB", data_type = "UFIXED", scale = 0.1, address = [3]},
    { name = "capacity", byte_order = "AB", data_type = "UFIXED", scale = 0.1, address = [4]},
    { name = "runtime", byte_order = "AB", data_type = "UINT16", scale = 1.0, address = [5]},
    { name = "battery_v", byte_order = "AB", data_type = "UFIXED", scale = 0.1, address = [6]},
    { name = "sys_fault", byte_order = "AB", data_type = "UINT16", scale = 1.0, address = [7]},
    { name = "mod_fault", byte_order = "AB", data_type = "UINT16", scale = 1.0, address = [8]},
    { name = "temperature", byte_order = "AB", data_type = "UINT16", scale = 1.0, address = [9]},
    { name = "status", byte_order = "AB", data_type = "UINT16", scale = 1.0, address = [10]},
    { name = "set_voltage_rb", byte_order = "AB", data_type = "UFIXED", scale = 0.1, address = [11]},
    { name = "set_current_rb", byte_order = "AB", data_type = "UFIXED", scale = 0.1, address = [12]},
    { name = "output_enable", byte_order = "AB", data_type = "UINT16", scale = 1.0, address = [13]}
  ]

[[inputs.modbus]]
  name = "psu09"
  slave_id = 1
  timeout = "200ms"
  interval = "100ms"
  controller = "tcp://192.168.10.11:502"
  
  holding_registers = [
    { name = "voltage", byte_order = "AB", data_type = "UFIXED", scale = 0.1, address = [1]},
    { name = "current", byte_order = "AB", data_type = "UFIXED", scale = 0.1, address = [2]},
    { name = "power", byte_order = "AB", data_type = "UFIXED", scale = 0.1, address = [3]},
    { name = "capacity", byte_order = "AB", data_type = "UFIXED", scale = 0.1, address = [4]},
    { name = "runtime", byte_order = "AB", data_type = "UINT16", scale = 1.0, address = [5]},
    { name = "battery_v", byte_order = "AB", data_type = "UFIXED", scale = 0.1, address = [6]},
    { name = "sys_fault", byte_order = "AB", data_type = "UINT16", scale = 1.0, address = [7]},
    { name = "mod_fault", byte_order = "AB", data_type = "UINT16", scale = 1.0, address = [8]},
    { name = "temperature", byte_order = "AB", data_type = "UINT16", scale = 1.0, address = [9]},
    { name = "status", byte_order = "AB", data_type = "UINT16", scale = 1.0, address = [10]},
    { name = "set_voltage_rb", byte_order = "AB", data_type = "UFIXED", scale = 0.1, address = [11]},
    { name = "set_current_rb", byte_order = "AB", data_type = "UFIXED", scale = 0.1, address = [12]},
    { name = "output_enable", byte_order = "AB", data_type = "UINT16", scale = 1.0, address = [13]}
  ]

[[inputs.modbus]]
  name = "psu10"
  slave_id = 1
  timeout = "200ms"
  interval = "100ms"
  controller = "tcp://192.168.10.12:502"
  
  holding_registers = [
    { name = "voltage", byte_order = "AB", data_type = "UFIXED", scale = 0.1, address = [1]},
    { name = "current", byte_order = "AB", data_type = "UFIXED", scale = 0.1, address = [2]},
    { name = "power", byte_order = "AB", data_type = "UFIXED", scale = 0.1, address = [3]},
    { name = "capacity", byte_order = "AB", data_type = "UFIXED", scale = 0.1, address = [4]},
    { name = "runtime", byte_order = "AB", data_type = "UINT16", scale = 1.0, address = [5]},
    { name = "battery_v", byte_order = "AB", data_type = "UFIXED", scale = 0.1, address = [6]},
    { name = "sys_fault", byte_order = "AB", data_type = "UINT16", scale = 1.0, address = [7]},
    { name = "mod_fault", byte_order = "AB", data_type = "UINT16", scale = 1.0, address = [8]},
    { name = "temperature", byte_order = "AB", data_type = "UINT16", scale = 1.0, address = [9]},
    { name = "status", byte_order = "AB", data_type = "UINT16", scale = 1.0, address = [10]},
    { name = "set_voltage_rb", byte_order = "AB", data_type = "UFIXED", scale = 0.1, address = [11]},
    { name = "set_current_rb", byte_order = "AB", data_type = "UFIXED", scale = 0.1, address = [12]},
    { name = "output_enable", byte_order = "AB", data_type = "UINT16", scale = 1.0, address = [13]}
  ]

# System Monitoring
[[inputs.cpu]]
  percpu = false
  totalcpu = true

[[inputs.mem]]

[[inputs.disk]]
  ignore_fs = ["tmpfs", "devtmpfs", "devfs"]

# Processor to convert analog inputs to float
[[processors.converter]]
  namepass = ["analog_inputs", "temperature_controller"]
  [processors.converter.fields]
    float = ["AI01","AI02","AI03","AI04","AI05","AI06","AI07","AI08",
             "TC01","TC02","TC03","TC04","TC05","TC06","TC07","TC08",
             "TC09","TC10","TC11","TC12","TC13","TC14","TC15","TC16"]

# Processor to ensure BGA metrics are properly typed
[[processors.converter]]
  namepass = ["bga_metrics"]
  [processors.converter.fields]
    float = ["purity", "uncertainty", "temperature", "pressure"]
    string = ["primary_gas", "secondary_gas"]